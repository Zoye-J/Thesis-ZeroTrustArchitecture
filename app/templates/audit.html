<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZTA Security Dashboard</title>
    <style>
        /* Add your CSS styles here - can reuse from existing templates */
        .zta-event { margin: 10px 0; padding: 10px; border-left: 4px solid #ccc; }
        .event-jwt { border-color: #3498db; }
        .event-mtls { border-color: #2ecc71; }
        .event-opa { border-color: #9b59b6; }
        .event-granted { border-color: #27ae60; background: #e8f6ef; }
        .event-denied { border-color: #c0392b; background: #fadbd8; }
        .zta-flow { display: flex; justify-content: space-between; margin: 20px 0; }
        .flow-step { flex: 1; text-align: center; padding: 10px; border: 1px solid #ddd; }
        .flow-active { background: #3498db; color: white; }
    </style>
</head>
<body>
    <h1>ZTA Security Event Dashboard</h1>
    
    <div class="stats-container">
        <h3>Live Statistics</h3>
        <div id="stats">Loading...</div>
    </div>
    
    <div class="zta-flow" id="ztaFlow">
        <!-- ZTA flow visualization will be inserted here -->
    </div>
    
    <h3>Real-time Events</h3>
    <div id="eventStream"></div>
    
    <script>
        // WebSocket or polling for real-time updates
        function fetchEvents() {
            fetch('/api/audit/events/recent')
                .then(r => r.json())
                .then(data => {
                    displayEvents(data.events);
                    updateStats();
                });
            
            setTimeout(fetchEvents, 2000); // Poll every 2 seconds
        }
        
        function displayEvents(events) {
            const container = document.getElementById('eventStream');
            container.innerHTML = events.map(event => `
                <div class="zta-event event-${getEventClass(event)}">
                    <strong>${new Date(event.timestamp).toLocaleTimeString()}</strong>
                    <br>${event.event_type}
                    <br><small>${JSON.stringify(event.details)}</small>
                    <br><small>Request: ${event.request_id}</small>
                </div>
            `).join('');
        }
        
        function getEventClass(event) {
            if (event.event_type.includes('JWT')) return 'jwt';
            if (event.event_type.includes('MTLS')) return 'mtls';
            if (event.event_type.includes('OPA')) return 'opa';
            if (event.event_type.includes('GRANTED')) return 'granted';
            if (event.event_type.includes('DENIED')) return 'denied';
            return '';
        }
        
        function updateStats() {
            fetch('/api/audit/statistics')
                .then(r => r.json())
                .then(stats => {
                    document.getElementById('stats').innerHTML = `
                        Total Events: ${stats.total_events}<br>
                        Access Granted: ${stats.by_outcome.granted}<br>
                        Access Denied: ${stats.by_outcome.denied}<br>
                        OPA Allows: ${stats.opa_decisions.allowed}<br>
                        OPA Denies: ${stats.opa_decisions.denied}
                    `;
                });
        }
        
        // Start polling
        fetchEvents();
    </script>
</body>
</html>